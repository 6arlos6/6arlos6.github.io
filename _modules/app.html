<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>app &mdash; Dama_project 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Dama_project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dama_project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">app</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for app</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;**Modulo: app.py / (Principal)**</span>

<span class="sd">Este es el script principal el cual sirve para ejecutar la aplicación en el puerto 5000.</span>
<span class="sd">Contiene una sección de log-in/log-ou, renderización de páginas principales de usuarios y servicios,</span>
<span class="sd">estructura de control para la generación de reportes dependiendo del rol del usuario,</span>
<span class="sd">carga y descarga de reportes en formato excel. Nota: La configuración esta dada</span>
<span class="sd">en el modulo &quot;config.py&quot; re recomienda ir a este para conocer la configuración</span>
<span class="sd">de la aplicación en servidor y conexiona a base de datos. &quot;&quot;&quot;</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># Librerias oficiales python:</span>
<span class="c1"># ============================================================================</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">send_file</span>
<span class="kn">from</span> <span class="nn">flask_mysqldb</span> <span class="kn">import</span> <span class="n">MySQL</span>
<span class="kn">from</span> <span class="nn">flask_wtf.csrf</span> <span class="kn">import</span> <span class="n">CSRFProtect</span>
<span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="n">LoginManager</span><span class="p">,</span> <span class="n">login_user</span><span class="p">,</span> <span class="n">logout_user</span><span class="p">,</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">secure_filename</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">json</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># self Models:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># SQL QUERY MODELS</span>
<span class="kn">from</span> <span class="nn">models.ModelUser</span> <span class="kn">import</span> <span class="n">ModelUser</span>
<span class="kn">from</span> <span class="nn">models.ModelUser</span> <span class="kn">import</span> <span class="n">ModelAdmin</span>
<span class="c1"># Entities:</span>
<span class="kn">from</span> <span class="nn">models.entities.User</span> <span class="kn">import</span> <span class="n">User</span>
<span class="c1"># MODEL REPORTES</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span> <span class="n">ExcelServicios</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span> <span class="n">ExcelAdmin2</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span> <span class="n">ExcelSia</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span> <span class="n">ExcelFacultades</span>
<span class="c1"># FUNCIONES AUXILIARE</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span> <span class="n">allowed_file</span>
<span class="kn">from</span> <span class="nn">reportes.backend.dll_copy</span> <span class="kn">import</span>  <span class="n">render_informe</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># OBJETOS:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># APP</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">csrf</span> <span class="o">=</span> <span class="n">CSRFProtect</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQL</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">login_manager_app</span> <span class="o">=</span> <span class="n">LoginManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="c1"># MODELOS:</span>
<span class="n">PATH_PRINCIPAL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="c1"># MODEL NUEVOS:</span>
<span class="n">MODEL_SERVICIOS</span> <span class="o">=</span> <span class="n">ExcelServicios</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">)</span>
<span class="n">MODEL_ADMIN</span> <span class="o">=</span> <span class="n">ExcelAdmin2</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">)</span>
<span class="n">MODEL_SIA</span> <span class="o">=</span> <span class="n">ExcelSia</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">)</span>
<span class="n">MODEL_FACULTADES</span> <span class="o">=</span> <span class="n">ExcelFacultades</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">)</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># Login:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># Login por el ID en base de datos:</span>
<div class="viewcode-block" id="load_user"><a class="viewcode-back" href="../app.html#app.load_user">[docs]</a><span class="nd">@login_manager_app</span><span class="o">.</span><span class="n">user_loader</span>
<span class="k">def</span> <span class="nf">load_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica mediante el id en la base de datos si el usuario esta logueado.</span>

<span class="sd">    :param id: id del usuario, defaults to None</span>
<span class="sd">    :type id: int</span>
<span class="sd">    :return: usuario por id</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span></div>

<span class="c1"># Ruta principal para hacer login:</span>
<div class="viewcode-block" id="index"><a class="viewcode-back" href="../app.html#app.index">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion re-dirige a la pagina de login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de loguin.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span></div>

<span class="c1"># Control Login:</span>
<div class="viewcode-block" id="login"><a class="viewcode-back" href="../app.html#app.login">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion permite renderizar el html de login, y busca al usuario en la base de datos, controla:</span>
<span class="sd">    usuario no registrado o contraseña sea incorrecta, en caso de que los datos esten correctos,</span>
<span class="sd">    este redirige hacia la pagina principal del usuario asignandole un rol que viene por defecto en la base de datos.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de loguin.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="c1"># get user.</span>
        <span class="n">logged_user</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">logged_user</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># identificar si esta logueado.</span>
            <span class="k">if</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">password</span><span class="p">:</span> <span class="c1"># identificar contraseña</span>
                <span class="n">login_user</span><span class="p">(</span><span class="n">logged_user</span><span class="p">)</span>

                <span class="c1"># ROLES para rederigir a su self-HOME:</span>
                <span class="c1"># ============================================ </span>
                <span class="k">if</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="c1"># ADMIN</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_admin&#39;</span><span class="p">))</span>
                
                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
                    <span class="c1"># SIA</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_sia&#39;</span><span class="p">))</span>
                
                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                    <span class="c1"># ACOMPAÑAMIENTO</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_acompanamiento&#39;</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
                    <span class="c1"># STEM</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_stem&#39;</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
                    <span class="c1"># PSL</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_psl&#39;</span><span class="p">))</span>
                
                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
                    <span class="c1"># FAC_ADMIN</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_admin&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span>
                    <span class="c1"># FAC_ING_ARQ</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ing_arq&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span> <span class="o">==</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span>
                    <span class="c1"># FAC_CIENCIAS</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">rol</span>
                    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_user</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ciencias&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No hay rol especifico&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span>
                <span class="c1"># ============================================ </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Invalid password...&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;User not found...&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># Cerrar Sesion:</span>
<div class="viewcode-block" id="logout"><a class="viewcode-back" href="../app.html#app.logout">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion permite hacer el log-out a cualquier usuario, despues redirije a la pagina principal de login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de loguin.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logout_user</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># AYUDA:</span>
<span class="c1"># ============================================================================</span>
<div class="viewcode-block" id="home_ayuda"><a class="viewcode-back" href="../app.html#app.home_ayuda">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_ayuda&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_ayuda</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion renderiza la pagina de ayuda, la cual contiene el manual de usuario.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_ayuda.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">back</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_ayuda.html&#39;</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="n">back</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">back</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_ayuda.html&#39;</span><span class="p">,</span> <span class="n">back</span><span class="o">=</span><span class="n">back</span><span class="p">)</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># ADMINISTRADOR:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_admin"><a class="viewcode-back" href="../app.html#app.home_admin">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_admin&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_admin</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_admin.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_admin&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_admin.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
<span class="c1"># API:</span>
<div class="viewcode-block" id="home_api"><a class="viewcode-back" href="../app.html#app.home_api">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_api&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_api</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion controla la API de creacion de usuarios del administrador Permite crear usuarios con las entradas de username,</span>
<span class="sd">    password, fullname (nombre completo), rol, date_mod(fecha de moficiación en la actualización de datos).</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de admin/home_api.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="n">mensaje</span> <span class="o">=</span> <span class="n">ModelAdmin</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">db</span><span class="p">,</span>
                                        <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                                        <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
                                        <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">],</span>
                                        <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">],</span>
                                        <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;date_mod&#39;</span><span class="p">])</span>
            <span class="n">flash</span><span class="p">(</span><span class="n">mensaje</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_api&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;admin/home_api.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># REPORTES ADMIN:</span>
<div class="viewcode-block" id="home_reportes_generales"><a class="viewcode-back" href="../app.html#app.home_reportes_generales">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_reportes_generales&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_reportes_generales</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_reportes_generales&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="s2">&quot;admin_reportes_generales&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Matriculados_Informacion_Basica_ant.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Matriculados_Informacion_Basica_presente.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Matriculados_por_periodo.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Inscripcion_de_asignaturas.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;admin/home_general_files.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;siapss.xlsx&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SIA + programa de Gov&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Publicación fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
<span class="c1"># ============================================================================</span>
<span class="c1"># SIA:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_sia"><a class="viewcode-back" href="../app.html#app.home_sia">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_sia&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_sia</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_sia.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_sia&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_sia.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># MI-MATRICULADOS:</span>
<div class="viewcode-block" id="home_matriculados"><a class="viewcode-back" href="../app.html#app.home_matriculados">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/matriculados&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_matriculados</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_matriculados&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;sia&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">21</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Matriculados_Informacion_Basica_ant.xlsx&#39;</span><span class="p">,</span> <span class="c1"># semestre anterior</span>
                                    <span class="s1">&#39;Matriculados_Informacion_Basica_presente.xlsx&#39;</span><span class="p">,</span> <span class="c1"># este semestre</span>
                                    <span class="s1">&#39;Matriculados_por_periodo.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Matriculados_Informacion_Basica.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Inscripcion_de_asignaturas.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;matriculados.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;sia/home_matriculados.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;matriculados.xlsx&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SIA matriculados&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
    
<span class="c1"># ESTADISTICAS:</span>
<div class="viewcode-block" id="home_estadisticas"><a class="viewcode-back" href="../app.html#app.home_estadisticas">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/estadisticas&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_estadisticas</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_estadisticas&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;sia&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;horarios_y_grupos.xlsx&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;asignaturas_inscritas.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;estadisticas.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;sia/home_estadisticas.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;estadisticas.xlsx&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SIA estadisticas&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># PROYECTOS Y TESIS:</span>
<div class="viewcode-block" id="home_proyectos_y_tesis"><a class="viewcode-back" href="../app.html#app.home_proyectos_y_tesis">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/proyectos_tesis&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_proyectos_y_tesis</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_proyectos_y_tesis&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;sia&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">23</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;horarios_y_grupos.xlsx&#39;</span><span class="p">,</span> <span class="c1"># semestre anterior</span>
                                    <span class="s1">&#39;asignaturas_inscritas.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;proyectos_y_tesis.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;sia/home_tesis_proyectos_grado.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;proyectos_y_tesis.xlsx&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SIA proyectos y tesis&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span>  </div>

<span class="c1"># TUTORES:</span>
<div class="viewcode-block" id="home_tutores"><a class="viewcode-back" href="../app.html#app.home_tutores">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/tutores&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_tutores</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_tutores&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;sia&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tutores.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_presente_tutores.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;tutores.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;sia/home_tutores.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tutores.xlsx&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SIA tutores&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># ACOMPAÑAMIENTO:</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_acompanamiento"><a class="viewcode-back" href="../app.html#app.home_acompanamiento">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_acompanamiento&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_acompanamiento</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_acompañamiento.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_acompanamiento&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_acompanamiento.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># acompanamiento_unal_lee:</span>
<div class="viewcode-block" id="home_unal_lee"><a class="viewcode-back" href="../app.html#app.home_unal_lee">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/unal_lee&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_unal_lee</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_unal_lee&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;acompanamiento&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">31</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unal_lee.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;unal_lee.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;acompanamiento/home_unal_lee.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unal_lee&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unal_lee.xlsx&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># acompanamiento_tramites_solicitudes:</span>
<div class="viewcode-block" id="home_tramites_y_solicitudes"><a class="viewcode-back" href="../app.html#app.home_tramites_y_solicitudes">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/tramites_y_solcitudes&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_tramites_y_solicitudes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_tramites_y_solicitudes&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;acompanamiento&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tramites_solicitudes.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;tramites_solicitudes.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;acompanamiento/home_tramites.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tramites_y_solicitudes&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tramites_solicitudes.xlsx&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># acompanamiento_focad</span>
<div class="viewcode-block" id="home_focad"><a class="viewcode-back" href="../app.html#app.home_focad">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/focad&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_focad</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_focad&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;acompanamiento&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">33</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;focad.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;focad.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;acompanamiento/home_focad.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;focad&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;focad.xlsx&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># acompanamiento_catedra:</span>
<div class="viewcode-block" id="home_catedra"><a class="viewcode-back" href="../app.html#app.home_catedra">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/catedra&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_catedra</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_catedra&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;acompanamiento&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">34</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;catedra.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;catedra.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;acompanamiento/home_catedra.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;catedra&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;catedra.xlsx&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># acompanamiento_tut_geas:</span>
<div class="viewcode-block" id="home_tutorias_y_geas"><a class="viewcode-back" href="../app.html#app.home_tutorias_y_geas">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/tutgeas&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_tutorias_y_geas</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_tutorias_y_geas&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;acompanamiento&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;geas_tutorias.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;geas_tutorias.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;acompanamiento/home_tutorias_y_geas.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tutorias_y_geas&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;geas_tutorias.xlsx&#39;</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="c1"># Fecha:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># STEM:</span>
<span class="c1"># ============================================================================</span>
<div class="viewcode-block" id="home_stem"><a class="viewcode-back" href="../app.html#app.home_stem">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_stem&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_stem</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_stem.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_stem&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_stem.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># stem:</span>
<div class="viewcode-block" id="home_stem_informe_1"><a class="viewcode-back" href="../app.html#app.home_stem_informe_1">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stem_informe_1&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_stem_informe_1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_stem_informe_1&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;stem&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stem.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;stem.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;stem/home_stem_informe_1.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stem_servicios&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stem.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># PSL:</span>
<span class="c1"># ============================================================================</span>
<div class="viewcode-block" id="home_psl"><a class="viewcode-back" href="../app.html#app.home_psl">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/home_psl&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_psl</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_psl.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_psl&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_psl.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># psl_taller_intracatedra:</span>
<div class="viewcode-block" id="home_taller_intracatedra"><a class="viewcode-back" href="../app.html#app.home_taller_intracatedra">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/taller_intracatedra&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_taller_intracatedra</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_taller_intracatedra&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;psl&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">51</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;taller_intracatedra.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;taller_intracatedra.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;psl/home_taller_intracatedra.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Taller intracatedra&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;taller_intracatedra.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># psl_actividades_voluntarias:</span>
<div class="viewcode-block" id="home_actividades_voluntarias"><a class="viewcode-back" href="../app.html#app.home_actividades_voluntarias">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/actividades_voluntarias&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_actividades_voluntarias</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_actividades_voluntarias&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;psl&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">52</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;actividades_voluntarias.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;actividades_voluntarias.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;psl/home_actividades_voluntarias.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Actividades voluntarias&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;actividades_voluntarias.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># FAC_ADMIN</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_fac_admin"><a class="viewcode-back" href="../app.html#app.home_fac_admin">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_admin&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_admin</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_fac_admin.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_admin&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_fac_admin.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># fac_admin:</span>
<div class="viewcode-block" id="home_fac_admin_reporte"><a class="viewcode-back" href="../app.html#app.home_fac_admin_reporte">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_admin_reporte&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_admin_reporte</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_admin_reporte&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;fac_admin&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">61</span>
        <span class="c1">#session[&#39;required_files&#39;] = [&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">]</span>
        <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE ADMINISTRACION&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;fac_admin/home_fac_admin_reporte.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Seguimiento Academico&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
         <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
<span class="c1"># ============================================================================</span>
<span class="c1"># FAC_ING_ARQ</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_fac_ing_arq"><a class="viewcode-back" href="../app.html#app.home_fac_ing_arq">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_ing_arq&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_ing_arq</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_fac_ing_arq.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ing_arq&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_fac_ing_arq.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># fac_ciencias:</span>
<div class="viewcode-block" id="home_fac_ing_arq_reporte"><a class="viewcode-back" href="../app.html#app.home_fac_ing_arq_reporte">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_ing_arq_reporte&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_ing_arq_reporte</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ing_arq_reporte&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;fac_ing_arq&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">71</span>
        <span class="c1">#session[&#39;required_files&#39;] = [&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">]</span>
        <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE INGENIERIA Y ARQUITECTURA&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;fac_ing_arq/home_fac_ing_arq_reporte.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Seguimiento Academico&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
         <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
<span class="c1"># ============================================================================</span>
<span class="c1"># FAC_CIENCIAS</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># HOME:</span>
<div class="viewcode-block" id="home_fac_ciencias"><a class="viewcode-back" href="../app.html#app.home_fac_ciencias">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_ciencas&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_ciencias</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion redirige a la pagina de home_admin.html. Identifica si el rol es adecuado y sino lo es redirige a login.</span>

<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_fac_ciencias.html o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ciencias&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home_fac_ciencias.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>

<span class="c1"># fac_ciencias:</span>
<div class="viewcode-block" id="home_fac_ciencias_reporte"><a class="viewcode-back" href="../app.html#app.home_fac_ciencias_reporte">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fac_ciencias_reporte&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">home_fac_ciencias_reporte</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion identifica el rol, si el rol coincide con el servicio define parametros del objeto session, con la siguiente informacion:</span>
<span class="sd">    * &#39;back_url&#39; : url del servicio.</span>
<span class="sd">    * &#39;path&#39; : path del servicio.</span>
<span class="sd">    * &#39;report&#39; : id del reporte.</span>
<span class="sd">    * &#39;required_files&#39;: Archivos requeridos para hacer el reporte.</span>
<span class="sd">    * &#39;download_file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;path_template&#39;: path del template del sercicio.</span>
<span class="sd">    * &#39;file&#39;: Nombre de archivo que contendrá el reporte .xslx</span>
<span class="sd">    * &#39;servicio&#39; : Nombre del servicio.</span>
<span class="sd">    * &#39;msjhelp1&#39;: Mensaje de ayuda para subir archivos.</span>
<span class="sd">    * &#39;msjhelp2&#39;: Mensaje de ayuda para generar reporte.</span>
<span class="sd">    * &#39;msjhelp3&#39;: Mensaje de ayuda para descargar reporte.</span>

<span class="sd">    Tambien, toma la fecha actual y actualiza el mensaje &#39;msj_actualizacion&#39; con la fecha en la cual</span>
<span class="sd">    se realizo la ultima modificación de datos.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Redireccion a la pagina de home_servicio o a login.html.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;rol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;home_fac_ciencias_reporte&#39;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;fac_ciencias&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">81</span>
        <span class="c1"># session[&#39;required_files&#39;] = [&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;, &#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">]</span>
        <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE CIENCIAS EXACTAS Y NATURALES&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;fac_ciencias/home_fac_ciencias_reporte.html&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Seguimiento Academico&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
         <span class="c1"># Ayuda:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;El archivo (o archivos) de subida debe tener el nombre de &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">])</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite generar el reporte. Recuerda que la información en el dash board se actualiza automaticamente cada 15 min.&quot;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Este boton permite descargar en formato excel el reporte generado.&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">get_date_modf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ultima actualización de datos:  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="c1"># get actual modfificacion</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">render_informe</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No tienes acceso.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;auth/login.html&#39;</span><span class="p">)</span></div>
<span class="c1"># ============================================================================</span>
<span class="c1"># SUBIR, GENERAR, DESCARGAR</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># SUBIR:</span>
<div class="viewcode-block" id="upload"><a class="viewcode-back" href="../app.html#app.upload">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/subir&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">upload</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion permite subir archivos. Identifica que su nombre sea el adecuado por servicio,</span>
<span class="sd">    que se haya seleccionado archivos (que la carga no sea nula) y que cada uno tenga extencion permitida.</span>
<span class="sd">    si se cumple con estas tres condiciones el archivo es subido a la carpeta data/subidos del respectivo</span>
<span class="sd">    servicios.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: Refresca la pagina actual.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">uploaded_files</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;file[]&quot;</span><span class="p">)</span> <span class="c1"># Archivos.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uploaded_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>  <span class="n">uploaded_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No has seleccionado un archivo&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">])</span> <span class="c1"># pagina anterior</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">file_names_upload</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_u</span><span class="o">.</span><span class="n">filename</span>  <span class="k">for</span> <span class="n">file_u</span> <span class="ow">in</span> <span class="n">uploaded_files</span><span class="p">]</span>
        <span class="n">list_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="ow">in</span> <span class="n">file_names_upload</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]]</span>
        <span class="n">tf_upload</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">list_check</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tf_upload</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Nombre de archivo incorrecto&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">])</span> <span class="c1"># pagina anterior</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">uploaded_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">allowed_file</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
            <span class="n">file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;El archivo </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1"> tiene una extension no permitida.&#39;</span><span class="p">)</span>
    <span class="c1"># This line is essential, store the data in session</span>
    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;filenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filenames</span>
    <span class="c1">#return render_template(&#39;upload.html&#39;, filenames=filenames)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">])</span></div>
<span class="c1"># GENERAR:</span>
<div class="viewcode-block" id="generar"><a class="viewcode-back" href="../app.html#app.generar">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/generar&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">generar</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Esta funcion permite generar reporte. En funcion de session[&#39;report&#39;] define el path de los archivos necesarios,</span>
<span class="sd">    el path de guardado (se hace siempre en la carpeta generados del servicio correspondiente), se realiza el informe y es</span>
<span class="sd">    exportado como una datafram de pandas el cual se usa para escribir la hoja de excel y las hojas de google sheet correspondientes</span>
<span class="sd">    para actualizar la dash board, se actualiza en la base de datos el estado de la fecha de acrualización y se devuelve un mensaje</span>
<span class="sd">    200 de exito al temrinarl el proceso en un diccionario. Nota: En algunos reportes hay variaciones minimas de la anterior descripción.</span>


<span class="sd">    :param None: No recibe funcion.</span>
<span class="sd">    :type: None</span>
<span class="sd">    :return: response json</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Se esta ejecutando generar con el reporte = </span><span class="si">{</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ADMIN ========================================================================:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_estudiantes_ant</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_ant.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_estudiantes_now</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_presente.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_asig</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Inscripcion_de_asignaturas.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_matr_pp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_por_periodo.xlsx&#39;</span><span class="p">)</span>
                <span class="n">list_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name_asig</span><span class="p">,</span> <span class="n">name_matr_pp</span><span class="p">]</span>
                <span class="c1"># Guardar:</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># outputs:</span>
                <span class="n">df_admin_1</span> <span class="o">=</span> <span class="n">MODEL_ADMIN</span><span class="o">.</span><span class="n">main_siaspp2</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_estudiantes_ant</span><span class="p">,</span> <span class="n">name_estudiantes_now</span><span class="p">,</span> <span class="n">list_names</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">periodo</span><span class="o">=</span><span class="s1">&#39;2022-2S&#39;</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">MODEL_ADMIN</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_admin_1</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMIN_1&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">MODEL_ADMIN</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_admin_1</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMIN_1&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># flask mensaje</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha de modificacion:</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
                
            <span class="c1"># SIA =============================================================================:</span>
            <span class="c1"># matriculados</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>
                <span class="c1"># Archivos requeridos:</span>
                <span class="n">name_estudiantes_now</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_ant.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_estudiantes_ant</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_presente.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_matr_pp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_por_periodo.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_asignaturas</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Inscripcion_de_asignaturas.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_matr_ib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># periodo de reporte:</span>
                <span class="n">periodo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;periodo&quot;</span><span class="p">]</span> <span class="c1"># poner form en html</span>
                <span class="c1"># save</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;matriculados.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># df historico:</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;matriculados&#39;</span><span class="p">,</span> <span class="s1">&#39;principal&#39;</span><span class="p">)</span>
                <span class="c1"># df:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">main_matriculados</span><span class="p">(</span><span class="n">name_asignaturas</span><span class="p">,</span> <span class="n">name_estudiantes_now</span><span class="p">,</span> <span class="n">name_estudiantes_ant</span><span class="p">,</span> <span class="n">name_matr_ib</span><span class="p">,</span> <span class="n">name_matr_pp</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">periodo</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;matriculados&#39;</span><span class="p">,</span> <span class="s1">&#39;principal&#39;</span><span class="p">)</span>
                <span class="c1"># mensaje flash:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># estadisticas:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
                <span class="c1"># Archivos requeridos:</span>
                <span class="n">name_sia_grphor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;horarios_y_grupos.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_sia_asignaturas</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;asignaturas_inscritas.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># periodo de generacion del informe:</span>
                <span class="n">periodo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;periodo&quot;</span><span class="p">]</span> <span class="c1"># poner form en html</span>
                <span class="c1"># save</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;estadisticas.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># df historico:</span>
                <span class="c1">#df_historico = MODEL_SERVICIOS.get_google_sheet(&#39;sia&#39;, &#39;matriculados&#39;, &#39;principal&#39;)</span>
                <span class="c1"># df:</span>
                <span class="n">df_1</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">estadisticas_1</span><span class="p">(</span><span class="n">name_sia_grphor</span><span class="p">)</span>
                <span class="c1"># proceso de guardad:</span>
                <span class="n">df_pre_nuevos</span><span class="p">,</span> <span class="n">df_pre_antiguos</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">inscritos_nivel</span><span class="p">(</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="s1">&#39;PREGRADO&#39;</span><span class="p">,</span> <span class="n">periodo</span><span class="p">)</span>
                <span class="n">df_pos_nuevos</span><span class="p">,</span> <span class="n">df_pos_antiguos</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">inscritos_nivel</span><span class="p">(</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="s1">&#39;POSGRADO&#39;</span><span class="p">,</span> <span class="n">periodo</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_1</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadisticas&#39;</span><span class="p">,</span> <span class="s1">&#39;asignaturas&#39;</span><span class="p">)</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_pre_nuevos</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadisticas&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMITIDOS PREGRADO&#39;</span><span class="p">)</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_pre_antiguos</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadisticas&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIGUOS PREGRADO&#39;</span><span class="p">)</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_pos_nuevos</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadisticas&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMITIDOS POSGRADO&#39;</span><span class="p">)</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_pos_antiguos</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;estadisticas&#39;</span><span class="p">,</span> <span class="s1">&#39;ANTIGUOS POSGRADO&#39;</span><span class="p">)</span>
                <span class="c1"># save excel</span>
                <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">df_1</span><span class="p">,</span> <span class="s1">&#39;asignaturas&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df_pre_nuevos</span><span class="p">,</span> <span class="s1">&#39;ADMITIDOS PREGRADO&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df_pre_antiguos</span><span class="p">,</span><span class="s1">&#39;ANTIGUOS PREGRADO&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df_pos_nuevos</span><span class="p">,</span> <span class="s1">&#39;ADMITIDOS POSGRADO&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df_pos_antiguos</span><span class="p">,</span><span class="s1">&#39;ANTIGUOS POSGRADO&#39;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
                <span class="c1"># mensaje flash:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># proyecto de grado y tesis:    </span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>
                <span class="c1"># Archivos requeridos:</span>
                <span class="n">name_sia_grphor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;horarios_y_grupos.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_sia_asignaturas</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;asignaturas_inscritas.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># save:</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;proyectos_y_tesis.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># df:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">proyectos_tesis</span><span class="p">(</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="n">name_sia_grphor</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;Proyectos_tesis&#39;</span><span class="p">,</span> <span class="s1">&#39;Principal&#39;</span><span class="p">)</span>
                <span class="c1"># mensaje flash:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            <span class="c1"># tutores:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
                <span class="c1"># Archivos requeridos:</span>
                <span class="n">name_tutores</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;tutores.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_matriculados</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;Matriculados_Informacion_Basica_presente_tutores.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># save:</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;tutores.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># df:</span>
                <span class="n">df_list</span><span class="p">,</span> <span class="n">df_todo</span> <span class="o">=</span> <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">tutores</span><span class="p">(</span><span class="n">name_tutores</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">name_matriculados</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">nombre</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>
                    <span class="n">list_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">df</span><span class="p">,</span><span class="n">nombre</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.4</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;tutores&#39;</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;tutores&#39;</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># todo</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_todo</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;tutores&#39;</span><span class="p">,</span> <span class="s1">&#39;TODO&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_todo</span><span class="p">,</span> <span class="s1">&#39;sia&#39;</span><span class="p">,</span> <span class="s1">&#39;tutores&#39;</span><span class="p">,</span> <span class="s1">&#39;TODO&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1"># to excel:</span>
                <span class="n">list_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">df_todo</span><span class="p">,</span><span class="s1">&#39;TODO&#39;</span><span class="p">))</span>
                <span class="n">MODEL_SIA</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
                <span class="c1"># mensaje flash</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># ACOMPAÑAMIENTO=============================================================:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span> <span class="c1"># Unal_lee</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;unal_lee.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;unal_lee.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Historico....</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HISTORICO ==================================================&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_1&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_historico</span><span class="p">))</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_1&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="c1"># SQL</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">upload_df</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;acmp_1&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            <span class="c1"># tramites</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;tramites_solicitudes.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;tramites_solicitudes.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_2&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_2&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            <span class="c1"># focad:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">33</span><span class="p">:</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;focad.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># save</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;focad.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_3&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_3&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># catedra:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">34</span><span class="p">:</span>
                <span class="c1"># catedra.xlsx</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;catedra.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># save</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;catedra.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_4&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_4&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># geas y tutorias:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">35</span><span class="p">:</span> <span class="c1"># geas y tutorias</span>
                <span class="c1"># geas_tutorias.xlsx</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;geas_tutorias.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;acompanamiento&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;geas_tutorias.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_5&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;ACMP_5&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>

            <span class="c1"># STEM ========================================================:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">41</span><span class="p">:</span>
                <span class="c1"># stem_act_1.xlsx, &#39;STEM_1&#39;</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;stem&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;stem.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;stem&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;stem.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;STEM_1&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;STEM_1&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>

            <span class="c1"># PSL =================================================================:</span>
            <span class="c1"># taller intracatedra:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">51</span><span class="p">:</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;psl&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;taller_intracatedra.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;psl&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;taller_intracatedra.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;PSL_1&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;PSL_1&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>

            <span class="c1"># actividades voluntarias:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">52</span><span class="p">:</span>
                <span class="c1"># Archivos Requeridos:</span>
                <span class="n">name_load</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;psl&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;actividades_voluntarias.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;psl&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="s1">&#39;actividades_voluntarias.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># Desde admin:</span>
                <span class="n">name_pss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;siapss.xlsx&#39;</span><span class="p">)</span>
                <span class="n">name_pss2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span><span class="s1">&#39;admin_reportes_generales&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;SPP.xlsx&#39;</span><span class="p">)</span>
                <span class="n">df_historico</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">get_google_sheet</span><span class="p">(</span><span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;PSL_2&#39;</span><span class="p">)</span>
                <span class="c1"># DF:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">make_service2pss</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">)</span>
                <span class="c1"># cambiar modulo servicios de aca para abajo.</span>
                <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;PSL_2&#39;</span><span class="p">)</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>

            <span class="c1"># FAC_ADMIN =================================================================:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">61</span><span class="p">:</span>
                <span class="c1"># facultad:</span>
                <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE ADMINISTRACION&quot;</span>
                <span class="c1"># archivos requeridos:</span>
                <span class="n">name_act</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_admin&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">)</span>
                <span class="c1">#name_nod = os.path.join(&#39;fac_admin&#39;,&#39;subidos&#39;,&#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="c1">#name_est = os.path.join(&#39;fac_admin&#39;,&#39;subidos&#39;,&#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="n">name_nod</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">name_est</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># save</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_admin&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># periodo:</span>
                <span class="n">periodo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;periodo&quot;</span><span class="p">]</span>
                <span class="c1"># df</span>
                <span class="n">df_act_fac</span><span class="p">,</span> <span class="n">df_nod_fac</span><span class="p">,</span> <span class="n">df_est_fac</span> <span class="o">=</span> <span class="n">MODEL_FACULTADES</span><span class="o">.</span><span class="n">main_facultad</span><span class="p">(</span><span class="n">name_act</span><span class="p">,</span> <span class="n">name_nod</span><span class="p">,</span> <span class="n">name_est</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">facultad</span><span class="p">,</span> <span class="n">periodo</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_ADMIN_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ADMIN_B&#39;,w=0)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ADMIN_C&#39;,w=0)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_ADMIN_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ADMIN_B&#39;,w=1)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ADMIN_C&#39;,w=1)</span>
                <span class="c1"># mensaje flash</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            
            <span class="c1"># FAC_INGENIERIA_ARQUITECTURA =================================================================:</span>
                
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">71</span><span class="p">:</span>
                <span class="c1"># facultad:</span>
                <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE INGENIERIA Y ARQUITECTURA&quot;</span>
                <span class="c1"># archivos requeridos:</span>
                <span class="n">name_act</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_ing_arq&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">)</span>
                <span class="c1">#name_nod = os.path.join(&#39;fac_ing_arq&#39;,&#39;subidos&#39;,&#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="c1">#name_est = os.path.join(&#39;fac_ing_arq&#39;,&#39;subidos&#39;,&#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="n">name_nod</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">name_est</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># save:</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_ing_arq&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># periodo:</span>
                <span class="n">periodo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;periodo&quot;</span><span class="p">]</span>
                <span class="c1"># df:</span>
                <span class="n">df_act_fac</span><span class="p">,</span> <span class="n">df_nod_fac</span><span class="p">,</span> <span class="n">df_est_fac</span> <span class="o">=</span> <span class="n">MODEL_FACULTADES</span><span class="o">.</span><span class="n">main_facultad</span><span class="p">(</span><span class="n">name_act</span><span class="p">,</span> <span class="n">name_nod</span><span class="p">,</span> <span class="n">name_est</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">facultad</span><span class="p">,</span> <span class="n">periodo</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_ING_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ING_B&#39;,w=0)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ING_C&#39;,w=0)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_ING_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ING_B&#39;,w=1)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_ING_C&#39;,w=1)</span>
                <span class="c1"># mensaje flash</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
            <span class="c1"># FAC_CIENCIAS =================================================================:</span>
            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">81</span><span class="p">:</span>
                <span class="c1"># facultad:</span>
                <span class="n">facultad</span> <span class="o">=</span> <span class="s2">&quot;FACULTAD DE CIENCIAS EXACTAS Y NATURALES&quot;</span>
                <span class="c1"># Archivos requeridos:</span>
                <span class="n">name_act</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_ciencias&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="s1">&#39;RE_ACT_PER_TABLA_DE_DATOS.xlsx&#39;</span><span class="p">)</span>
                <span class="c1">#name_nod = os.path.join(&#39;fac_ciencias&#39;,&#39;subidos&#39;,&#39;RE_NOD_FIN_GRA_PER_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="c1">#name_est = os.path.join(&#39;fac_ciencias&#39;,&#39;subidos&#39;,&#39;RE_EST_LDA_TABLA_DE_DATOS.xlsx&#39;)</span>
                <span class="n">name_nod</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">name_est</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># save:</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;fac_ciencias&#39;</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span><span class="s1">&#39;facultad_&#39;</span><span class="o">+</span> <span class="n">facultad</span> <span class="o">+</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">)</span>
                <span class="c1"># periodo:</span>
                <span class="n">periodo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;periodo&quot;</span><span class="p">]</span>
                <span class="c1"># df:</span>
                <span class="n">df_act_fac</span><span class="p">,</span> <span class="n">df_nod_fac</span><span class="p">,</span> <span class="n">df_est_fac</span> <span class="o">=</span> <span class="n">MODEL_FACULTADES</span><span class="o">.</span><span class="n">main_facultad</span><span class="p">(</span><span class="n">name_act</span><span class="p">,</span> <span class="n">name_nod</span><span class="p">,</span> <span class="n">name_est</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">facultad</span><span class="p">,</span> <span class="n">periodo</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span>
                <span class="c1"># to google:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_CIENCIAS_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_CIENCIAS_B&#39;,w=0)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_CIENCIAS_C&#39;,w=0)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">MODEL_SERVICIOS</span><span class="o">.</span><span class="n">write_google_sheet</span><span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;servicio&#39;</span><span class="p">,</span> <span class="s1">&#39;REPORTES_DAMA&#39;</span><span class="p">,</span> <span class="s1">&#39;FAC_CIENCIAS_A&#39;</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_nod_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_CIENCIAS_B&#39;,w=1)</span>
                    <span class="c1">#MODEL_SERVICIOS.write_google_sheet(df_est_fac, &#39;servicio&#39;, &#39;REPORTES_DAMA&#39;, &#39;FAC_CIENCIAS_C&#39;,w=1)</span>
                <span class="c1"># mensaje flash:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Cruce Realizado.&#39;</span><span class="p">)</span>
                <span class="c1"># Actualizar fecha</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">date_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span> <span class="c1"># PONER HORA</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">msj</span> <span class="o">=</span> <span class="n">ModelUser</span><span class="o">.</span><span class="n">update_date</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_time</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Hubo un error en encontrar los archivos.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="s1">&#39;not OK&#39;</span><span class="p">})</span></div>

<span class="c1"># DESCARGAR:</span>
<div class="viewcode-block" id="descargar"><a class="viewcode-back" href="../app.html#app.descargar">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/descargar/&lt;path:filename&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">descargar</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion recibe el nombre del archivo (filename) desde la ruta y en funcion del session[&#39;path&#39;], descarga el</span>
<span class="sd">    archivo solicitado.</span>


<span class="sd">    :param filename: Nombre del archivo</span>
<span class="sd">    :type: str</span>
<span class="sd">    :return: Respuesta para descargar archivo.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
        <span class="n">uploads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="s1">&#39;generados&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">uploads</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Hubo un error en encontrar los archivos.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;back_url&#39;</span><span class="p">])</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># HTML ERROR:</span>
<span class="c1"># ============================================================================</span>
<div class="viewcode-block" id="status_401"><a class="viewcode-back" href="../app.html#app.status_401">[docs]</a><span class="k">def</span> <span class="nf">status_401</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion controla el error 401 redireccionando al login.</span>


<span class="sd">    :param error: Numero de error.</span>
<span class="sd">    :type: int</span>
<span class="sd">    :return: Redirección a login.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="status_404"><a class="viewcode-back" href="../app.html#app.status_404">[docs]</a><span class="k">def</span> <span class="nf">status_404</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion controla el error 404 redireccionando al login.</span>


<span class="sd">    :param error: Numero de error.</span>
<span class="sd">    :type: int</span>
<span class="sd">    :return: mensaje de pagina no encontrada.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;h1&gt;Página no encontrada&lt;/h1&gt;&quot;</span><span class="p">,</span> <span class="mi">404</span></div>

<div class="viewcode-block" id="status_405"><a class="viewcode-back" href="../app.html#app.status_405">[docs]</a><span class="k">def</span> <span class="nf">status_405</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Esta funcion controla el error 405 redireccionando al login.</span>


<span class="sd">    :param error: Numero de error.</span>
<span class="sd">    :type: int</span>
<span class="sd">    :return: Redirección a login.</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span>  <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)),</span> <span class="mi">405</span></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># MAIN:</span>
<span class="c1"># ============================================================================</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="s2">&quot;Ejecucion principal&quot;</span>
    <span class="c1"># configuracion del app</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;development&#39;</span><span class="p">])</span>
    <span class="c1"># proteger con csrf</span>
    <span class="n">csrf</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="c1"># control de errores</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">status_401</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="n">status_404</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">405</span><span class="p">,</span> <span class="n">status_405</span><span class="p">)</span>
    <span class="c1"># correr aplicación</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Carlos Riascos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>