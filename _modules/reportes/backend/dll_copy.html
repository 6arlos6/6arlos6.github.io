<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>reportes.backend.dll_copy &mdash; Dama_project 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Dama_project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Dama_project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">reportes.backend.dll_copy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for reportes.backend.dll_copy</h1><div class="highlight"><pre>
<span></span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Modulo: dll_copy.py / Objetos para realizar informes y funciones auxiliares**</span>

<span class="sd">Este script crea las clases con los metodos para realizar los informes en la funcion generar de del modulo principal (app).</span>
<span class="sd">Tambien tiene funciones auxiliares usadas en (app).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ============================================================================</span>
<span class="c1"># Librerias oficiales python:</span>
<span class="c1"># ============================================================================</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">reportes.security.update_google_sheet</span> <span class="kn">import</span> <span class="n">my_worksheet</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">unidecode</span> <span class="kn">import</span> <span class="n">unidecode</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># Objetos:</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="ExcelPreprocessMain"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain">[docs]</a><span class="k">class</span> <span class="nc">ExcelPreprocessMain</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Esta es la clase madre de los reportes, la cual permite interactuar con los archivos de excel</span>
<span class="sd">  asi tambien como con las hojas de excel, para escribir y leer sobre estas.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_gen</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path_gen</span>
  <span class="c1"># LOAD:</span>
<div class="viewcode-block" id="ExcelPreprocessMain.load"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain.load">[docs]</a>  <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>
  <span class="c1"># WRITES:</span>
<div class="viewcode-block" id="ExcelPreprocessMain.write"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain.write">[docs]</a>  <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span></div>
  <span class="c1"># WRITES ENGINE:</span>
<div class="viewcode-block" id="ExcelPreprocessMain.write_engine"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain.write_engine">[docs]</a>  <span class="k">def</span> <span class="nf">write_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_dfs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tpl_df</span> <span class="ow">in</span> <span class="n">list_dfs</span><span class="p">:</span>
      <span class="n">df</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tpl_df</span>
      <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>
  <span class="c1"># WRITES GOOGLE SHEET:</span>
<div class="viewcode-block" id="ExcelPreprocessMain.write_google_sheet"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain.write_google_sheet">[docs]</a>  <span class="k">def</span> <span class="nf">write_google_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">rol</span><span class="p">,</span> <span class="n">documento</span><span class="p">,</span> <span class="n">hoja</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">work_s</span> <span class="o">=</span> <span class="n">my_worksheet</span><span class="p">(</span><span class="n">rol</span><span class="p">,</span> <span class="n">documento</span><span class="p">,</span> <span class="n">hoja</span><span class="p">)</span>
      <span class="n">work_s</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
      <span class="n">work_s</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">value_input_option</span><span class="o">=</span><span class="s1">&#39;USER_ENTERED&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">filas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
      <span class="n">columnas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
      <span class="n">work_s</span> <span class="o">=</span> <span class="n">my_worksheet</span><span class="p">(</span><span class="n">rol</span><span class="p">,</span> <span class="n">documento</span><span class="p">,</span> <span class="n">hoja</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">filas</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">columnas</span><span class="p">)</span>
      <span class="n">work_s</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
      <span class="n">work_s</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">value_input_option</span><span class="o">=</span><span class="s1">&#39;USER_ENTERED&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="ExcelPreprocessMain.get_google_sheet"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelPreprocessMain.get_google_sheet">[docs]</a>  <span class="k">def</span> <span class="nf">get_google_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rol</span><span class="p">,</span><span class="n">documento</span><span class="p">,</span><span class="n">hoja</span><span class="p">):</span>
    <span class="n">work_s</span> <span class="o">=</span> <span class="n">my_worksheet</span><span class="p">(</span><span class="n">rol</span><span class="p">,</span> <span class="n">documento</span><span class="p">,</span> <span class="n">hoja</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">work_s</span><span class="o">.</span><span class="n">get_all_records</span><span class="p">(</span><span class="n">numericise_ignore</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">df</span></div></div>
  
<div class="viewcode-block" id="ExcelServicios"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelServicios">[docs]</a><span class="k">class</span> <span class="nc">ExcelServicios</span><span class="p">(</span><span class="n">ExcelPreprocessMain</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Esta hereda la clase madre y permite generar los reportes de los servicios principalmente</span>
<span class="sd">  de acompañamiento, psl y stem.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ExcelServicios.make_service2pss"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelServicios.make_service2pss">[docs]</a>  <span class="k">def</span> <span class="nf">make_service2pss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_pss</span><span class="p">,</span> <span class="n">name_load</span><span class="p">,</span> <span class="n">name_pss2</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">):</span>
    <span class="c1"># Cargar siapss:</span>
    <span class="n">df_siaspp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Cargar unal_lee subido principal:</span>
    <span class="n">df_ppl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_load</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Convert fecha a datetime y errores volver NaT:</span>
    <span class="n">df_ppl</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_ppl</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="c1"># Rellenar datos perdidos en fecha (para arriba, para abajo):</span>
    <span class="n">df_ppl</span><span class="p">[[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_ppl</span><span class="p">[[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
    <span class="n">df_ppl</span><span class="p">[[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_ppl</span><span class="p">[[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfill&#39;</span><span class="p">)</span>
    <span class="c1"># Convertir documento a texto:</span>
    <span class="n">df_ppl</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.0&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Quitar informacion redudante con el SIA:</span>
    <span class="n">df_ppl_2</span> <span class="o">=</span> <span class="n">df_ppl</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NOMBRES Y APELLIDOS&#39;</span><span class="p">,</span><span class="s1">&#39;PROGRAMA&#39;</span><span class="p">,</span><span class="s1">&#39;CORREO&#39;</span><span class="p">])</span>
    <span class="c1"># Juntar df actual con siaspp:</span>
    <span class="n">df_ppl_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_ppl_2</span><span class="p">,</span> <span class="n">df_siaspp</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">)</span>
    <span class="c1"># Copia del df merged:</span>
    <span class="n">df_ppl_3_copy</span> <span class="o">=</span> <span class="n">df_ppl_3</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># Rellenar datos de facultar:</span>
    <span class="k">if</span> <span class="s1">&#39;MI-FACULTAD&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
      <span class="n">index_nan_FACULTAD</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span> <span class="n">df_ppl_3</span><span class="p">[</span><span class="s1">&#39;FACULTAD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="p">]</span><span class="o">.</span><span class="n">index</span>
      <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_nan_FACULTAD</span> <span class="p">,</span><span class="s1">&#39;FACULTAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="s1">&#39;MI-FACULTAD&#39;</span><span class="p">]</span>
    <span class="c1"># Rellenar datos de plan:</span>
    <span class="n">index_nan_PLAN</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span> <span class="n">df_ppl_3</span><span class="p">[</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_nan_PLAN</span> <span class="p">,</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl</span><span class="p">[</span><span class="s1">&#39;PROGRAMA&#39;</span><span class="p">]</span>
    <span class="c1"># volver a cargar DPSS</span>
    <span class="n">df_pss2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_pss2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># cargo programa de gov.</span>
    <span class="c1"># Convertir documento a texto:</span>
    <span class="n">df_pss2</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_pss2</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.0&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Obtengo documento de filas donde cohorte es nulo:</span>
    <span class="n">df_ppl_5</span> <span class="o">=</span> <span class="n">df_ppl_3</span><span class="p">[</span><span class="n">df_ppl_3</span><span class="p">[</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span>
    <span class="c1"># Busco todas las filas de df_pss2 donde cohorte es nulo:</span>
    <span class="n">df_pss2_R</span> <span class="o">=</span> <span class="n">df_pss2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_pss2</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_ppl_5</span><span class="p">))]</span>
    <span class="c1"># Tomo cedulas de filas nulas:</span>
    <span class="n">Ced_gov_null</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_pss2_R</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">])</span>
    <span class="c1"># Por cada una pongo en COHORTE el valor de dpss</span>
    <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Ced_gov_null</span><span class="p">:</span>
      <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">DOCUMENTO</span> <span class="o">==</span> <span class="n">cc</span><span class="p">,</span> <span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_pss2_R</span><span class="p">[</span><span class="n">df_pss2_R</span><span class="o">.</span><span class="n">DOCUMENTO</span> <span class="o">==</span> <span class="n">cc</span><span class="p">][</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># En los que definitivamente no se encontro, se busca y se pone Estudiante Regular:</span>
    <span class="n">index_nan_CO</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_nan_CO</span> <span class="p">,</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Estudiante Regular&#39;</span>
    <span class="c1"># Convertir a texto Cedula-Ri:</span>
    <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="s1">&#39;CEDULA-RI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="s1">&#39;CEDULA-RI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.0&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Rellenar todos los valores con valores vacios:</span>
    <span class="n">df_ppl_3_copy</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Quitar tildes y espacios:</span>
    <span class="n">columnas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columnas</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PROM_ACADEMICO_ACTUAL&#39;</span><span class="p">,</span><span class="s1">&#39;PAPA_PERIODO&#39;</span><span class="p">,</span><span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">unidecode</span><span class="p">)</span>
          <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ppl_3_copy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
          <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">df_historico</span><span class="o">.</span><span class="n">FECHA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_historico</span><span class="o">.</span><span class="n">FECHA</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>
    <span class="c1"># Concatenar historico con actual:</span>
    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_historico</span><span class="p">,</span> <span class="n">df_ppl_3_copy</span><span class="p">])</span>
    <span class="c1"># Ordenar la df en funcion de la fecha:</span>
    <span class="n">df_ppl_3_copy</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;FECHA&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">df_concat</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;FECHA&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Convertirla a string:</span>
    <span class="n">df_concat</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_concat</span><span class="p">[</span><span class="s1">&#39;FECHA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
    <span class="c1"># Rellenar todos los valores con valores vacios:</span>
    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">df_concat</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Escribo documento excel:</span>
    <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">df_ppl_3_copy</span><span class="p">,</span> <span class="s1">&#39;PRINCIPAL&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">df_concat</span><span class="p">,</span> <span class="s1">&#39;HISTORICO&#39;</span><span class="p">)</span>
              <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
    <span class="c1"># Devuelvo info actual + historica:</span>
    <span class="k">return</span> <span class="n">df_concat</span></div></div>

<div class="viewcode-block" id="ExcelAdmin2"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelAdmin2">[docs]</a><span class="k">class</span> <span class="nc">ExcelAdmin2</span><span class="p">(</span><span class="n">ExcelPreprocessMain</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Esta hereda la clase madre y permite generar del usuario administrador.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ExcelAdmin2.main_siaspp2"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelAdmin2.main_siaspp2">[docs]</a>  <span class="k">def</span> <span class="nf">main_siaspp2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_pss</span><span class="p">,</span> <span class="n">name_estudiantes_ant</span><span class="p">,</span> <span class="n">name_estudiantes_now</span><span class="p">,</span> <span class="n">name_lists</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">periodo</span><span class="o">=</span><span class="s1">&#39;2022-2S&#39;</span><span class="p">):</span>
    <span class="n">df_pss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_pss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># CARGAR PILOS</span>
    <span class="n">df_mib_ant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_estudiantes_ant</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># CARGAR SIA ANTERIOR</span>
    <span class="n">df_mib_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_estudiantes_now</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># CARGAR SIA HOY</span>
    <span class="n">df_hoy_ant</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_mib_now</span><span class="p">,</span> <span class="n">df_mib_ant</span><span class="p">])</span> <span class="c1"># Concatenar sia hoy con anterior</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">df_hoy_ant</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

    <span class="c1"># Desde aquí...</span>
    <span class="n">col_main</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># columnas requeridas</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_lists</span><span class="p">:</span>
      <span class="n">df_asig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># cargar df asignaturas (este es general)</span>
      <span class="n">col_asig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_asig</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># columnas nuevas</span>
      <span class="n">z</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col_main</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">col_asig</span><span class="p">))</span> <span class="c1"># cols de interseccion</span>
      <span class="n">drop_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col_asig</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span> <span class="c1"># quitar las col no interseccion</span>
      <span class="n">df_asing_new</span> <span class="o">=</span> <span class="n">df_asig</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">))</span> <span class="c1"># Borrar todas las no inters</span>
      <span class="n">df_asing_new</span> <span class="o">=</span> <span class="n">df_asing_new</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># rellenar nans</span>
      <span class="n">df_asing_new</span> <span class="o">=</span> <span class="n">df_asing_new</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">])</span> <span class="c1"># borrar duplicados by documento</span>
      <span class="n">set_doc_main</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">result_df</span><span class="o">.</span><span class="n">DOCUMENTO</span><span class="p">)</span>
      <span class="n">set_doc_sec</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_asing_new</span><span class="o">.</span><span class="n">DOCUMENTO</span><span class="p">)</span>
      <span class="n">z_doc</span> <span class="o">=</span> <span class="n">set_doc_sec</span> <span class="o">-</span> <span class="n">set_doc_main</span> <span class="c1"># set de cols que no estan </span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_doc</span><span class="p">))</span>
      <span class="c1"># Tomar todas las filas que se encuentran en la lista de las cedulas que no estan en el df</span>
      <span class="c1"># principal y crear una nueva dataframe</span>
      <span class="n">df_asing_new_rest</span> <span class="o">=</span> <span class="n">df_asing_new</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_asing_new</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">z_doc</span><span class="p">))]</span>
      <span class="c1"># Poner PERIODO</span>
      <span class="k">if</span> <span class="s1">&#39;PERIODO&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_asing_new_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df_asing_new_rest</span><span class="o">.</span><span class="n">PERIODO</span> <span class="o">=</span> <span class="n">periodo</span>
      <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">result_df</span><span class="p">,</span> <span class="n">df_asing_new_rest</span><span class="p">])</span>
    <span class="c1"># Continuar con el proceso ....</span>
    <span class="n">df_drop_correo</span> <span class="o">=</span> <span class="n">df_pss</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CORREO&#39;</span><span class="p">])</span>
    <span class="n">df_drop_correo</span><span class="o">.</span><span class="n">DOCUMENTO</span> <span class="o">=</span> <span class="n">df_drop_correo</span><span class="o">.</span><span class="n">DOCUMENTO</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
    <span class="n">df_siaspp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">result_df</span><span class="p">,</span> <span class="n">df_drop_correo</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">)</span>
    <span class="n">df_siaspp</span><span class="p">[</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">df_siaspp</span><span class="p">[</span><span class="s1">&#39;COHORTE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Estudiante Regular&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df_siaspp</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
    <span class="n">df_siaspp</span><span class="o">=</span>  <span class="n">df_siaspp</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_siaspp</span></div></div>

<div class="viewcode-block" id="ExcelFacultades"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelFacultades">[docs]</a><span class="k">class</span> <span class="nc">ExcelFacultades</span><span class="p">(</span><span class="n">ExcelPreprocessMain</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Esta  clase hereda la clase madre y permite generar los reportes de facultades.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ExcelFacultades.main_facultad"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelFacultades.main_facultad">[docs]</a>  <span class="k">def</span> <span class="nf">main_facultad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_act</span><span class="p">,</span> <span class="n">name_nod</span><span class="p">,</span> <span class="n">name_est</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">facultad</span><span class="p">,</span> <span class="n">periodo</span><span class="p">):</span>
    <span class="n">df_act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_act</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># col seleccionadas df_act:</span>
    <span class="n">col_act</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;FACULTAD&#39;</span><span class="p">,</span>
        <span class="s1">&#39;COD_PLAN&#39;</span><span class="p">,</span> <span class="s1">&#39;PLAN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CONVENIO_PLAN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;COD_NIVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;NIVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIST_ACAD&#39;</span><span class="p">,</span> <span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">,</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NOMBRES&#39;</span><span class="p">,</span> <span class="s1">&#39;APELLIDO1&#39;</span><span class="p">,</span> <span class="s1">&#39;APELLIDO2&#39;</span><span class="p">,</span> <span class="s1">&#39;NOMBRES_APELLIDOS&#39;</span><span class="p">,</span> <span class="s1">&#39;COD_ACCESO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ACCESO&#39;</span><span class="p">,</span> <span class="s1">&#39;COD_SUBACCESO&#39;</span><span class="p">,</span> <span class="s1">&#39;SUBACCESO&#39;</span><span class="p">,</span> <span class="s1">&#39;CONVOCATORIA&#39;</span><span class="p">,</span> <span class="s1">&#39;APERTURA&#39;</span><span class="p">,</span>
        <span class="s1">&#39;T_DOCUMENTO&#39;</span><span class="p">,</span> <span class="s1">&#39;GENERO&#39;</span><span class="p">,</span> <span class="s1">&#39;EMAIL&#39;</span><span class="p">,</span> <span class="s1">&#39;USUARIO&#39;</span><span class="p">,</span> <span class="s1">&#39;CODIGO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;FECHA_NACIMIENTO&#39;</span><span class="p">,</span> <span class="s1">&#39;EDAD&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMERO_MATRICULAS&#39;</span><span class="p">,</span> <span class="s1">&#39;PAPA&#39;</span><span class="p">,</span> <span class="s1">&#39;PROME_ACADE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PBM_CALCULADO&#39;</span><span class="p">,</span> <span class="s1">&#39;ESTRATO&#39;</span><span class="p">,</span><span class="s1">&#39;DEPTO_RESIDENCIA&#39;</span><span class="p">,</span><span class="s1">&#39;MUNICIPIO_RESIDENCIA&#39;</span><span class="p">,</span> <span class="s1">&#39;PAIS-NACIONALIDAD&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VICTIMAS_DEL_CONFLICTO&#39;</span><span class="p">,</span> <span class="s1">&#39;DISCAPACIDAD&#39;</span><span class="p">,</span><span class="s1">&#39;COD_NODO_INICIO&#39;</span><span class="p">,</span> <span class="s1">&#39;NODO_INICIO&#39;</span><span class="p">,</span><span class="s1">&#39;ESTADO&#39;</span><span class="p">,</span> <span class="s1">&#39;CARACTER_COLEGIO&#39;</span>
    <span class="p">]</span>
    <span class="n">df_act</span> <span class="o">=</span> <span class="n">df_act</span><span class="p">[</span><span class="n">col_act</span><span class="p">]</span>
    <span class="n">df_act</span> <span class="o">=</span> <span class="n">normalizacion_col</span><span class="p">(</span><span class="s2">&quot;FACULTAD&quot;</span><span class="p">,</span> <span class="n">df_act</span><span class="p">)</span>
    <span class="n">df_act_fac</span> <span class="o">=</span> <span class="n">df_act</span><span class="p">[</span><span class="n">df_act</span><span class="o">.</span><span class="n">FACULTAD</span> <span class="o">==</span> <span class="n">facultad</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># nod -&gt; FECHA_GRADO</span>
        <span class="c1"># act -&gt; FECHA_NACIMIENTO</span>
        <span class="n">df_act_fac</span><span class="p">[</span><span class="s1">&#39;FECHA_NACIMIENTO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_act_fac</span><span class="p">[</span><span class="s1">&#39;FECHA_NACIMIENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>
    <span class="n">df_act_fac</span> <span class="o">=</span> <span class="n">df_act_fac</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># periodo reporte:</span>
    <span class="n">df_act_fac</span><span class="p">[</span><span class="s2">&quot;PERIODO_REPORTE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">periodo</span>
    <span class="c1"># Escribo documento excel:</span>
    <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">df_act_fac</span><span class="p">,</span> <span class="s1">&#39;ACT&#39;</span><span class="p">)</span>
              <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>

    <span class="c1"># dummy:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df_act_fac</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">df2</span></div></div>


<div class="viewcode-block" id="ExcelSia"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia">[docs]</a><span class="k">class</span> <span class="nc">ExcelSia</span><span class="p">(</span><span class="n">ExcelPreprocessMain</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Esta  clase hereda la clase madre y permite generar los reportes de SIA.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ExcelSia.main_matriculados"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia.main_matriculados">[docs]</a>  <span class="k">def</span> <span class="nf">main_matriculados</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_asignaturas</span><span class="p">,</span><span class="n">name_estudiantes_now</span><span class="p">,</span><span class="n">name_estudiantes_ant</span><span class="p">,</span><span class="n">name_matr_ib</span><span class="p">,</span> <span class="n">name_matr_pp</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">periodo</span><span class="p">,</span> <span class="n">df_historico</span><span class="p">):</span>
    <span class="n">PATH_PRINCIPAL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="c1"># Asignarutas inscritas:</span>
    <span class="n">path_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">,</span><span class="n">name_asignaturas</span><span class="p">)</span>
    <span class="n">df_asignaturas_inscritas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_1</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Filtrar cedulas distintas por inscritos:</span>
    <span class="n">set_docs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_asignaturas_inscritas</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
    <span class="c1">#set_docs = list(set_docs)[:nn] # SOLO HASTA 50</span>
    <span class="c1"># Cargar Informacion básica 2022 - 2s:</span>
    <span class="n">path_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">,</span> <span class="n">name_estudiantes_now</span><span class="p">)</span>
    <span class="n">df_mib_now</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_2</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Cargar Informacion básica 2022-1s:</span>
    <span class="n">path_3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">,</span> <span class="n">name_estudiantes_ant</span><span class="p">)</span>
    <span class="n">df_mib_ant</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_3</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Cargar Matriculados Info Básica:</span>
    <span class="n">path_4</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">,</span> <span class="n">name_matr_ib</span><span class="p">)</span>
    <span class="n">df_MIB</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_4</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Cargar Matriculados por periodo:</span>
    <span class="n">path_5</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_PRINCIPAL</span><span class="p">,</span> <span class="n">name_matr_pp</span><span class="p">)</span>
    <span class="n">df_MPP</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_5</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TODAS LAS BASES DE DATOS CARGADAS. :) &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================&quot;</span><span class="p">)</span>
    <span class="c1"># CRUCE:</span>
    <span class="c1"># Listas vacias por caracteristica:</span>
    <span class="n">Creditos_inscritos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Genero</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Depart_nacimiento</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Cedula</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Cod_plan</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Plan</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Avance</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Tipo_de_Nivel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Convocatoria</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Apertura</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># CRUCE:</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">dni</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">set_docs</span><span class="p">):</span>
      <span class="c1"># INSCRITOS:</span>
      <span class="n">creditos_totales</span> <span class="o">=</span> <span class="n">DNI_2_TotCred</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># COD_PLAN</span>
      <span class="n">cod_plan</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;COD_PLAN&#39;</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># PLAN</span>
      <span class="n">plan</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;PLAN&#39;</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># TIPO DE NIVEL TIPO_NIVEL</span>
      <span class="n">tipo_nivel</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;TIPO_NIVEL&#39;</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># CONVOCATORIA:</span>
      <span class="n">convocatoria</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;CONVOCATORIA&#39;</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># APERTURA:</span>
      <span class="n">apertura</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;APERTURA&#39;</span><span class="p">,</span> <span class="n">df_asignaturas_inscritas</span><span class="p">)</span>
      <span class="c1"># SEXO:</span>
      <span class="n">sexo</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;SEXO&#39;</span><span class="p">,</span> <span class="n">df_mib_ant</span><span class="p">)</span> <span class="c1"># &#39;M&#39;, &#39;F&#39;, &#39;INDEFINIDO&#39;</span>
      <span class="k">if</span> <span class="n">sexo</span> <span class="o">==</span> <span class="s1">&#39;INDEFINIDO&#39;</span><span class="p">:</span>
        <span class="n">sexo</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;SEXO&#39;</span><span class="p">,</span> <span class="n">df_mib_now</span><span class="p">)</span> <span class="c1"># &#39;M&#39;, &#39;F&#39;, &#39;INDEFINIDO&#39;</span>
      <span class="c1"># DEPARTAMENTO:</span>
      <span class="n">departamento</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;DEPARTAMENTO_PROCEDENCIA&#39;</span><span class="p">,</span> <span class="n">df_MPP</span><span class="p">)</span> <span class="c1"># DEP o INDEFINIDO</span>
      <span class="c1"># AVANCE_CARRERA</span>
      <span class="c1"># df_basicos </span>
      <span class="c1"># df_MPP</span>
      <span class="c1"># df_matriculados</span>
      <span class="n">prc</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">,</span> <span class="n">df_mib_now</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">prc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">prc</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">,</span> <span class="n">df_mib_ant</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
          <span class="n">prc</span> <span class="o">=</span> <span class="n">DNI_2_Feature</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">,</span><span class="n">df_MIB</span><span class="p">)</span>
      <span class="c1"># AGREGAR:</span>
      <span class="n">Cedula</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
      <span class="n">Creditos_inscritos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creditos_totales</span><span class="p">)</span>
      <span class="n">Genero</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sexo</span><span class="p">)</span>
      <span class="n">Depart_nacimiento</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">departamento</span><span class="p">)</span>
      <span class="n">Cod_plan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cod_plan</span><span class="p">)</span>
      <span class="n">Plan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
      <span class="n">Avance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prc</span><span class="p">)</span>
      <span class="n">Tipo_de_Nivel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tipo_nivel</span><span class="p">)</span>
      <span class="n">Convocatoria</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">convocatoria</span><span class="p">)</span>
      <span class="n">Apertura</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apertura</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRUCE REALIZADO! :) &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================&quot;</span><span class="p">)</span>
    <span class="c1"># Crear dataframe final:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;CEDULA&#39;</span><span class="p">:</span> <span class="n">Cedula</span><span class="p">,</span>
        <span class="s1">&#39;SEXO&#39;</span><span class="p">:</span> <span class="n">Genero</span><span class="p">,</span>
        <span class="s1">&#39;TOTAL_CREDITOS&#39;</span><span class="p">:</span> <span class="n">Creditos_inscritos</span><span class="p">,</span>
        <span class="s1">&#39;DEPARTAMENTO&#39;</span><span class="p">:</span><span class="n">Depart_nacimiento</span><span class="p">,</span>
        <span class="s1">&#39;COD_PLAN&#39;</span><span class="p">:</span><span class="n">Cod_plan</span><span class="p">,</span>
        <span class="s1">&#39;PLAN&#39;</span><span class="p">:</span><span class="n">Plan</span><span class="p">,</span>
        <span class="s1">&#39;AVANCE&#39;</span><span class="p">:</span><span class="n">Avance</span><span class="p">,</span>
        <span class="s1">&#39;NIVEL_ESTUDIOS&#39;</span><span class="p">:</span><span class="n">Tipo_de_Nivel</span><span class="p">,</span>
        <span class="s1">&#39;CONVOCATORIA&#39;</span><span class="p">:</span><span class="n">Convocatoria</span><span class="p">,</span>
        <span class="s1">&#39;APERTURA&#39;</span><span class="p">:</span><span class="n">Apertura</span>
    <span class="p">})</span>
    <span class="c1"># Borrar NAN en df1</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;PERIODO_REPORTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">periodo</span>

    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_historico</span><span class="p">,</span> <span class="n">df1</span><span class="p">])</span>
    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">df_concat</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="s1">&#39;PRINCIPAL&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">df_concat</span><span class="p">,</span> <span class="s1">&#39;HISTORICO&#39;</span><span class="p">)</span>
              <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_concat</span></div>
  
<div class="viewcode-block" id="ExcelSia.estadisticas_1"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia.estadisticas_1">[docs]</a>  <span class="k">def</span> <span class="nf">estadisticas_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_sia_grphor</span><span class="p">):</span>
    <span class="c1"># cargar horarios y grupos:</span>
    <span class="n">df_hr_gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_sia_grphor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ubgga_ass</span> <span class="o">=</span> <span class="n">df_hr_gr</span><span class="p">[</span><span class="s1">&#39;UBGAA_ASS&#39;</span><span class="p">]</span>
    <span class="c1"># Campos:</span>
    <span class="n">departamento</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">asignaturas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grupos</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">cupos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inscritos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Departamentos:</span>
    <span class="n">Departamentos</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ubgga_ass</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">Departamentos</span><span class="p">:</span>
      <span class="c1"># por cada departamento tomar un trozo de datos:</span>
      <span class="n">df</span> <span class="o">=</span> <span class="n">df_hr_gr</span><span class="p">[</span><span class="n">df_hr_gr</span><span class="p">[</span><span class="s1">&#39;UBGAA_ASS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep</span><span class="p">]</span>
      <span class="c1"># tomar nombre se asignatura, id grupo, cupo y numero de inscritos:</span>
      <span class="n">df_asignaturas</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NOMBRE_ASS&#39;</span><span class="p">]</span>
      <span class="c1"># (Correccion: hacer set teniendo en cuenta la asignatura, porque los grupos pueden ser llamados igual)</span>
      <span class="n">n_asg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_asignaturas</span><span class="p">))</span> <span class="c1"># Numero de asignaturas distintas.</span>
      <span class="c1"># Numero de grupos distintos</span>
      <span class="n">grup</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NOMBRE_ASS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;PPAL_ID_GRUPO_ACTIVIDAD&#39;</span><span class="p">]</span>
      <span class="n">df_grupos</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">grup</span><span class="p">)</span>
      <span class="n">n_grup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_grupos</span><span class="p">)</span>
      <span class="c1"># Numero de cupos:</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      n_cupo = df_cupo.sum()</span>
<span class="sd">      n_inscritos = df_inscritos_.sum()</span>
<span class="sd">      # </span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="n">departamento</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
      <span class="n">asignaturas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_asg</span><span class="p">)</span>
      <span class="c1">#grupos.append(n_grup)</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      cupos.append(n_cupo)</span>
<span class="sd">      inscritos.append(n_inscritos)</span>
<span class="sd">      &#39;&#39;&#39;</span>
    <span class="n">ASIGNATURAS_OFERTADAS_PERIOD</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;DEPARTAMENTO&#39;</span><span class="p">:</span><span class="n">departamento</span><span class="p">,</span>
        <span class="s1">&#39;ASIGNATURAS&#39;</span><span class="p">:</span> <span class="n">asignaturas</span>
        <span class="c1">#&#39;GRUPOS&#39;: grupos</span>
          <span class="p">})</span>
        <span class="c1">#&#39;CUPOS&#39;: cupos,</span>
        <span class="c1">#&#39;INSCRITOS&#39;:inscritos</span>
        
    <span class="k">return</span> <span class="n">ASIGNATURAS_OFERTADAS_PERIOD</span></div>
<div class="viewcode-block" id="ExcelSia.inscritos_nivel"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia.inscritos_nivel">[docs]</a>  <span class="k">def</span> <span class="nf">inscritos_nivel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="n">tipo_nivel</span><span class="p">,</span> <span class="n">semestre_actual</span><span class="p">):</span>
    <span class="c1"># tomo pregrado:</span>
    <span class="c1"># (poner nivel como una varible):</span>
    <span class="n">df_inscritos</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># CARGAR SIA ANTERIOR</span>
    <span class="n">df_by_nivel</span> <span class="o">=</span> <span class="n">df_inscritos</span><span class="p">[</span><span class="n">df_inscritos</span><span class="p">[</span><span class="s1">&#39;TIPO_NIVEL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tipo_nivel</span><span class="p">]</span>
    <span class="c1"># selecciono dni set:</span>
    <span class="n">dnis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_by_nivel</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
    <span class="c1"># preparo listas:</span>
    <span class="n">plan_now</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cedula_now</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">apertura_now</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">plan_before</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cedula_before</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">apertura_before</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># para c/u cedulas...</span>
    <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">dnis</span><span class="p">:</span>
      <span class="c1"># obtengo su &quot;fila&quot;...</span>
      <span class="n">df_estudiante</span> <span class="o">=</span> <span class="n">df_by_nivel</span><span class="p">[</span><span class="n">df_by_nivel</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cc</span><span class="p">]</span>
      <span class="c1"># Si estudiante esta en convocatoria y aperturas semestre actual... (Poner semestre como una variable)</span>
      <span class="c1"># solo apertura ... sufiente</span>
      <span class="k">if</span> <span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;CONVOCATORIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">semestre_actual</span> <span class="ow">and</span> <span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">semestre_actual</span><span class="p">:</span>
        <span class="c1"># Obtengo su plan y lo guardo en planes</span>
        <span class="n">plan_now</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># tambien guardo su cedula:</span>
        <span class="n">cedula_now</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
        <span class="n">apertura_now</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">elif</span> <span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">semestre_actual</span><span class="p">:</span>
        <span class="n">plan_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cedula_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
        <span class="n">apertura_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_estudiante</span><span class="p">[</span><span class="s1">&#39;APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># guardo en diccionario informacion:</span>
    <span class="n">INSCRITOS_ANTIGUOS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;PLAN&#39;</span><span class="p">:</span> <span class="n">plan_before</span><span class="p">,</span>
        <span class="s1">&#39;CEDULA&#39;</span><span class="p">:</span> <span class="n">cedula_before</span><span class="p">,</span>
        <span class="s1">&#39;APERTURA&#39;</span><span class="p">:</span> <span class="n">apertura_before</span>
    <span class="p">}</span>
    <span class="n">INSCRITOS_NUEVOS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;PLAN&#39;</span><span class="p">:</span> <span class="n">plan_now</span><span class="p">,</span>
        <span class="s1">&#39;CEDULA&#39;</span><span class="p">:</span> <span class="n">cedula_now</span><span class="p">,</span>
        <span class="s1">&#39;APERTURA&#39;</span><span class="p">:</span> <span class="n">apertura_now</span>
    <span class="p">}</span>
    <span class="c1"># Escribo como datagrame plan y cedula...</span>
    <span class="n">df_INSCRITOS_ANTIGUOS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">INSCRITOS_ANTIGUOS</span><span class="p">)</span>
    <span class="n">df_INSCRITOS_NUEVOS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">INSCRITOS_NUEVOS</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">df_INSCRITOS_NUEVOS</span><span class="p">,</span> <span class="n">df_INSCRITOS_ANTIGUOS</span><span class="p">]</span></div>

<div class="viewcode-block" id="ExcelSia.proyectos_tesis"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia.proyectos_tesis">[docs]</a>  <span class="k">def</span> <span class="nf">proyectos_tesis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="n">name_sia_grphor</span><span class="p">,</span> <span class="n">name_save</span><span class="p">):</span>
    <span class="n">df_inscritos</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_sia_asignaturas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># CARGAR SIA ANTERIOR</span>
    <span class="n">df_hr_gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_sia_grphor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df_hr_gr_filtered</span> <span class="o">=</span> <span class="n">df_hr_gr</span><span class="p">[[</span>
                                <span class="s1">&#39;ID_ASSIGNATURA&#39;</span><span class="p">,</span> <span class="c1"># id asignatura</span>
                                <span class="s1">&#39;NOMBRE_ASS&#39;</span><span class="p">,</span> <span class="c1"># nombre asignatura</span>
                                <span class="s1">&#39;PPAL_ID_GRUPO_ACTIVIDAD&#39;</span><span class="p">,</span> <span class="c1"># id grupo</span>
                                <span class="s1">&#39;PPAL_DESC_GRUPO_ACTIVIDAD&#39;</span><span class="p">,</span> <span class="c1"># descripcion grupo</span>
                                <span class="s1">&#39;PPAL_NUM_INSCRITOS&#39;</span><span class="p">,</span> <span class="c1"># numero de inscritos</span>
                                <span class="s1">&#39;PPAL_DOC_DOCENTE&#39;</span><span class="p">,</span> <span class="c1"># documento docente</span>
                                <span class="s1">&#39;PPAL_NOMPRS&#39;</span> <span class="c1"># nombre docente</span>
                            <span class="p">]]</span>
    <span class="n">df_hr_gr_filtered</span> <span class="o">=</span> <span class="n">df_hr_gr_filtered</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># llenar nan con espacio texto vacio.</span>
    <span class="c1"># Columnas necesarias para inscritos</span>
    <span class="n">df_inscritos_filtered</span> <span class="o">=</span> <span class="n">df_inscritos</span><span class="p">[[</span>
                                        <span class="s1">&#39;COD_PLAN&#39;</span><span class="p">,</span> <span class="c1"># codigo plan</span>
                                        <span class="s1">&#39;PLAN&#39;</span><span class="p">,</span> <span class="c1"># plan</span>
                                        <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span> <span class="c1"># documento</span>
                                        <span class="s1">&#39;NOMBRES&#39;</span><span class="p">,</span> <span class="c1"># nombres</span>
                                        <span class="s1">&#39;APELLIDOS&#39;</span><span class="p">,</span> <span class="c1"># apellidos</span>
                                        <span class="s1">&#39;CORREO&#39;</span><span class="p">,</span> <span class="c1"># correo</span>
                                        <span class="s1">&#39;COD_ASIGNATURA&#39;</span><span class="p">,</span> <span class="c1"># cod asignatura</span>
                                        <span class="s1">&#39;ASIGNATURA&#39;</span><span class="p">,</span> <span class="c1"># asignatura</span>
                                        <span class="s1">&#39;GRUPO_ASIGNATURA&#39;</span> <span class="c1"># grupo asignatura</span>
                                        <span class="p">]]</span>
    <span class="n">df_inscritos_filtered</span> <span class="o">=</span> <span class="n">df_inscritos_filtered</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="c1"># llenar nan con espacio texto vacio.</span>
    <span class="n">df_inscritos_filtered</span><span class="p">[</span><span class="s1">&#39;DOCENTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># creo una columna que se llame docente...</span>

    <span class="n">list_tesis_proyectos</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;TRABAJO FINAL&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TRABAJO FINAL DE MAESTRIA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TESIS DE MAESTRIA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;PROYECTO DE TESIS DE DOCTORADO&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TESIS DE DOCTORADO&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TESIS&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TRABAJO FINAL DE MAESTRÍA&quot;</span><span class="p">,</span>
      <span class="s2">&quot;PROYECTO DE TESIS&quot;</span><span class="p">,</span>
      <span class="s2">&quot;TESIS DE MAESTRÍA&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">index_drop</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># lista vacia</span>

    <span class="c1"># Recorrer por filas a inscritos...</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_inscritos_filtered</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
      <span class="c1"># Tomo codigo de asignatura:</span>
      <span class="n">asignatura</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;COD_ASIGNATURA&#39;</span><span class="p">]</span>
      <span class="c1"># Tomo el grupo:</span>
      <span class="n">grupo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;GRUPO_ASIGNATURA&#39;</span><span class="p">]</span>
      <span class="c1"># Busco en grupos y horarios lugares donde coincida asignatura:</span>
      <span class="n">tf_doc_asignatura</span> <span class="o">=</span> <span class="n">df_hr_gr_filtered</span><span class="p">[</span><span class="s1">&#39;ID_ASSIGNATURA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">asignatura</span>
      <span class="c1"># Busco en grupos y horarios lugares donde coincida grupo:</span>
      <span class="n">tf_doc_grupo</span> <span class="o">=</span> <span class="n">df_hr_gr_filtered</span><span class="p">[</span><span class="s1">&#39;PPAL_ID_GRUPO_ACTIVIDAD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">grupo</span>
      <span class="c1"># Busco en horarios y grupos la coincidencia mutua (AND):</span>
      <span class="n">df_docente</span> <span class="o">=</span> <span class="n">df_hr_gr_filtered</span><span class="p">[</span><span class="n">tf_doc_asignatura</span> <span class="o">&amp;</span> <span class="n">tf_doc_grupo</span><span class="p">]</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Intento capturar el nombre de la asignatura:</span>
        <span class="n">asg</span> <span class="o">=</span> <span class="n">df_docente</span><span class="p">[</span><span class="s1">&#39;NOMBRE_ASS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># valido si esa asignatura pertenece a la lista de asignaturas necesarias:</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">valid_asignature</span><span class="p">(</span><span class="n">asg</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">list_tesis_proyectos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tf</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># si pertenece</span>
        <span class="c1"># Se extrae el nombre del docente:</span>
          <span class="n">docente_nombre</span> <span class="o">=</span> <span class="n">df_docente</span><span class="p">[</span><span class="s1">&#39;PPAL_NOMPRS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Se lo guarda en la col. creada llamada docente</span>
          <span class="n">row</span><span class="p">[</span><span class="s1">&#39;DOCENTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">docente_nombre</span>
        <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Sino entonces guardo indices para dropear</span>
          <span class="n">index_drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="c1"># Se ven tantos 0 porque es cuando no se encuentran coincidencias </span>
        <span class="c1"># e igual se guarda el indice para dropear:</span>
          <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_docente</span><span class="p">))</span> 
          <span class="n">index_drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># dropeo dataframe con las filas que no tienen la informacion requerida:</span>
    <span class="n">df_inscritos_filtered</span> <span class="o">=</span> <span class="n">df_inscritos_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_drop</span><span class="p">)</span>

    <span class="n">list_dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">df_inscritos_filtered</span><span class="p">,</span> <span class="s1">&#39;PRINCIPAL&#39;</span><span class="p">)</span>
              <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_engine</span><span class="p">(</span><span class="n">list_dfs</span><span class="p">,</span> <span class="n">name_save</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_inscritos_filtered</span></div>

<div class="viewcode-block" id="ExcelSia.tutores"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.ExcelSia.tutores">[docs]</a>  <span class="k">def</span> <span class="nf">tutores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name_tutores</span><span class="p">,</span> <span class="n">name_save</span><span class="p">,</span> <span class="n">name_matriculados</span><span class="p">):</span>

    <span class="n">df_tutores</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_tutores</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># CARGAR SIA ANTERIOR</span>
    <span class="n">df_tutores</span> <span class="o">=</span> <span class="n">df_tutores</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">planes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_tutores</span><span class="p">[</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

    <span class="c1"># Matriculados:</span>
    <span class="n">df_matriculados</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_matriculados</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df_nombres_apellidos</span> <span class="o">=</span> <span class="n">df_matriculados</span><span class="p">[[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">,</span> <span class="s2">&quot;APELLIDO1&quot;</span><span class="p">,</span> <span class="s2">&quot;APELLIDO2&quot;</span><span class="p">]]</span>
    <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;APELLIDO1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;APELLIDO2&quot;</span><span class="p">]</span>
    <span class="n">df_nombres_apellidos</span> <span class="o">=</span> <span class="n">df_nombres_apellidos</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">unidecode</span><span class="p">)</span>
    <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">matriculados_nombre</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">])</span>

    <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">plan</span> <span class="ow">in</span> <span class="n">planes</span><span class="p">:</span>
      <span class="c1"># plan i:</span>
      <span class="n">df_matriculados_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
      
      <span class="k">try</span><span class="p">:</span>
        <span class="n">name_estudiantes</span> <span class="o">=</span> <span class="s2">&quot;ESTUDIANTES_&quot;</span> <span class="o">+</span> <span class="n">plan</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span>
        <span class="n">name_estudiantes</span> <span class="o">=</span> <span class="n">name_estudiantes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">name_estudiantes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sia&#39;</span><span class="p">,</span><span class="s1">&#39;subidos&#39;</span><span class="p">,</span><span class="n">name_estudiantes</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">name_estudiantes</span><span class="p">))</span>
        <span class="n">df_estudiantes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name_estudiantes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">df_estudiantes</span> <span class="o">=</span> <span class="n">df_estudiantes</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">unidecode</span><span class="p">)</span>
        <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">df_estudiantes_R</span> <span class="o">=</span> <span class="n">df_estudiantes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_estudiantes</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">matriculados_nombre</span><span class="p">))]</span>
        <span class="n">nombres_r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_estudiantes_R</span><span class="o">.</span><span class="n">NOMBRES</span><span class="p">)</span>
        <span class="n">df_matriculados_2</span> <span class="o">=</span> <span class="n">df_matriculados</span><span class="p">[</span><span class="n">df_nombres_apellidos</span><span class="p">[</span><span class="s2">&quot;COMPLETO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nombres_r</span><span class="p">)]</span>
        <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;APELLIDOS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;APELLIDO1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;APELLIDO2&quot;</span><span class="p">]</span>
        <span class="c1"># cambiar nombre cols</span>
        <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;CORREO ESTUDIANTE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;CORREO&quot;</span><span class="p">]</span>
        <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;PERIODO_CONVOCATORIA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;CONVOCATORIA&quot;</span><span class="p">]</span>
        <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;PERIODO_APERTURA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="s2">&quot;APERTURA&quot;</span><span class="p">]</span>
        <span class="c1"># col intesection</span>
        <span class="n">col_tut</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_tutores</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">col_matri</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_matriculados_2</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">col_tut</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">col_matri</span><span class="p">)</span>
        <span class="n">df_matriculados_3</span> <span class="o">=</span> <span class="n">df_matriculados_2</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">cc</span><span class="p">)]</span>
        
      <span class="k">except</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se encontro </span><span class="si">{</span><span class="n">name_estudiantes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

      <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_tutores</span><span class="p">[</span><span class="n">df_tutores</span><span class="p">[</span><span class="s1">&#39;PLAN&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">plan</span><span class="p">]</span>
      <span class="n">df_con_tutor</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;TUTOR&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
      <span class="n">df_sin_tutor</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;TUTOR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">plan</span> <span class="o">==</span> <span class="s1">&#39;ADMINISTRACION DE EMPRESAS (N)&#39;</span><span class="p">:</span>
          <span class="n">plan</span> <span class="o">=</span> <span class="s1">&#39;ADMIN EMPRESAS (N)&#39;</span>
      <span class="k">elif</span> <span class="n">plan</span> <span class="o">==</span> <span class="s1">&#39;ADMINISTRACION DE EMPRESAS (D)&#39;</span><span class="p">:</span>
          <span class="n">plan</span> <span class="o">=</span> <span class="s1">&#39;ADMIN EMPRESAS (D)&#39;</span>
      <span class="k">elif</span> <span class="n">plan</span> <span class="o">==</span> <span class="s1">&#39;ADMINISTRACION DE SISTEMAS INFORMATICOS&#39;</span><span class="p">:</span>
          <span class="n">plan</span> <span class="o">=</span> <span class="s1">&#39;ADMIN SISINFO&#39;</span>
      <span class="k">elif</span> <span class="n">plan</span> <span class="o">==</span> <span class="s1">&#39;GESTION CULTURAL Y COMUNICATIVA&#39;</span><span class="p">:</span>
          <span class="n">plan</span> <span class="o">=</span> <span class="s1">&#39;GEST CULT&#39;</span>
      <span class="c1"># Matriculados:</span>
      <span class="n">df_con_tutor</span> <span class="o">=</span> <span class="n">df_con_tutor</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">df_con_tutor</span><span class="p">,</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; CT&#39;</span><span class="p">)</span> <span class="p">)</span>
      
      <span class="n">df_concat_sin_tutor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_sin_tutor</span><span class="p">,</span> <span class="n">df_matriculados_3</span><span class="p">])</span>
      <span class="n">df_concat_sin_tutor</span> <span class="o">=</span> <span class="n">df_concat_sin_tutor</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="n">df_concat_sin_tutor</span><span class="p">[</span><span class="s2">&quot;COMPLETOS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_concat_sin_tutor</span><span class="p">[</span><span class="s2">&quot;NOMBRES&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df_concat_sin_tutor</span><span class="p">[</span><span class="s2">&quot;APELLIDOS&quot;</span><span class="p">]</span>
      <span class="n">df_arq_st</span> <span class="o">=</span> <span class="n">df_concat_sin_tutor</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPLETOS&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
      <span class="n">df_arq_st</span> <span class="o">=</span> <span class="n">df_arq_st</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPLETOS&quot;</span><span class="p">])</span>
      <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">df_con_tutor</span><span class="p">,</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; CT&#39;</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">df_arq_st</span> <span class="p">,</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; ST&#39;</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">df_con_tutor</span><span class="p">[</span><span class="s2">&quot;PLAN_TUTOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; CT&#39;</span>
      <span class="n">df_arq_st</span><span class="p">[</span><span class="s2">&quot;PLAN_TUTOR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plan</span> <span class="o">+</span> <span class="s1">&#39; ST&#39;</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_con_tutor</span><span class="p">)</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_arq_st</span><span class="p">)</span>
    <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_df</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">df_list</span><span class="p">,</span> <span class="n">new_df</span></div></div>

<span class="c1"># ============================================================================</span>
<span class="c1"># FUNCIONES AUXILIARES:</span>
<span class="c1"># ============================================================================</span>
<div class="viewcode-block" id="DNI_2_TotCred"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.DNI_2_TotCred">[docs]</a><span class="k">def</span> <span class="nf">DNI_2_TotCred</span><span class="p">(</span><span class="n">DNI</span><span class="o">=</span><span class="mi">555</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="c1"># Cedula:</span>
    <span class="n">informe</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">DNI</span><span class="p">]</span>
     <span class="c1"># Creditos:</span>
    <span class="n">cred</span> <span class="o">=</span> <span class="n">informe</span><span class="p">[</span><span class="s1">&#39;CREDITOS_ASIGNATURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">DNI</span> <span class="o">==</span> <span class="s1">&#39;1080040060&#39;</span><span class="p">:</span>
      <span class="n">y</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cred</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cred</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cred</span><span class="p">)</span> <span class="c1"># Suma de creditos.</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Se encontro DNI pero por alguna razon no tiene creditos.</span>
  <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se encuentra col: &#39;</span> <span class="o">+</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="c1"># Sino se encuentra la col. DOCUMENTOS return -&gt; -2</span></div>
<div class="viewcode-block" id="DNI_2_Feature"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.DNI_2_Feature">[docs]</a><span class="k">def</span> <span class="nf">DNI_2_Feature</span><span class="p">(</span><span class="n">DNI</span><span class="o">=</span><span class="mi">555</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()):</span>
  <span class="c1"># Caracteristicas tipo texto:</span>
  <span class="n">string_1_feat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SEXO&#39;</span><span class="p">,</span> <span class="s1">&#39;DEPARTAMENTO_NACIMIENTO&#39;</span><span class="p">,</span><span class="s1">&#39;DEPARTAMENTO_PROCEDENCIA&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;TIPO_NIVEL&#39;</span><span class="p">,</span><span class="s1">&#39;CONVOCATORIA&#39;</span><span class="p">,</span><span class="s1">&#39;APERTURA&#39;</span><span class="p">]</span>
  <span class="c1"># Caracteristicas tipo numero:</span>
  <span class="n">num_1_feat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AVANCE_CARRERA&#39;</span><span class="p">]</span>
  <span class="c1"># Cedula:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df_buscado</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">DNI</span><span class="p">]</span> <span class="c1"># Empty DataFrame -&gt; No se encontro documento.</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Salida default:</span>
      <span class="n">salida</span> <span class="o">=</span> <span class="n">df_buscado</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="c1"># -&gt; salida = []</span>
      <span class="c1"># Busqueda texto:</span>
      <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">string_1_feat</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">salida</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">salida</span> <span class="o">=</span> <span class="s1">&#39;INDEFINIDO&#39;</span> <span class="c1"># No se encontró en df</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">salida</span> <span class="o">=</span> <span class="n">salida</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># string</span>
        <span class="k">return</span> <span class="n">salida</span>
      <span class="c1"># Busqueda numerica:</span>
      <span class="k">elif</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">num_1_feat</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">salida</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">salida</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span> <span class="c1"># No se encontró en df</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">salida</span> <span class="o">=</span> <span class="n">salida</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Numero</span>
        <span class="k">return</span> <span class="n">salida</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">salida</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se encuentra col: &#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="p">)</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">2</span>
  <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se encuentra col: &#39;</span> <span class="o">+</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="c1"># Sino se encuentra la col. DOCUMENTOS return -&gt; -2</span></div>
<span class="n">ALLOWED_EXTENSIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;csv&#39;</span><span class="p">}</span>
<div class="viewcode-block" id="allowed_file"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.allowed_file">[docs]</a><span class="k">def</span> <span class="nf">allowed_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">and</span> \
           <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ALLOWED_EXTENSIONS</span></div>
<div class="viewcode-block" id="files_in_data"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.files_in_data">[docs]</a><span class="k">def</span> <span class="nf">files_in_data</span><span class="p">(</span><span class="n">path_servicio</span><span class="p">):</span>
    <span class="c1"># folder path</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">path_servicio</span>

    <span class="c1"># list to store files</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterate directory</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
        <span class="c1"># check if current path is a file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>
<div class="viewcode-block" id="valid_asignature"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.valid_asignature">[docs]</a><span class="k">def</span> <span class="nf">valid_asignature</span><span class="p">(</span><span class="n">asg</span><span class="p">,</span> <span class="n">posibilities</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">asg</span> <span class="ow">in</span> <span class="n">posibilities</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>
<span class="c1"># General render informe</span>
<div class="viewcode-block" id="render_informe"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.render_informe">[docs]</a><span class="k">def</span> <span class="nf">render_informe</span><span class="p">(</span><span class="n">upload_folder</span><span class="p">,</span><span class="n">sessions</span><span class="p">):</span>
    <span class="n">path_servicio_upload</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_folder</span><span class="p">,</span><span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span><span class="s1">&#39;subidos&#39;</span><span class="p">)</span>
    <span class="n">path_servicio_download</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_folder</span><span class="p">,</span><span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span><span class="s1">&#39;generados&#39;</span><span class="p">)</span>
    <span class="c1"># lista de archivos:</span>
    <span class="n">files_upload</span> <span class="o">=</span> <span class="n">files_in_data</span><span class="p">(</span><span class="n">path_servicio_upload</span><span class="p">)</span>
    <span class="n">files_download</span> <span class="o">=</span> <span class="n">files_in_data</span><span class="p">(</span><span class="n">path_servicio_download</span><span class="p">)</span>
    <span class="c1"># mensaje:</span>
    <span class="c1"># Upload menssaje:</span>
    <span class="n">list_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">elm1</span> <span class="ow">in</span> <span class="n">files_upload</span> <span class="k">for</span> <span class="n">elm1</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;required_files&#39;</span><span class="p">]]</span>
    <span class="n">tf_upload</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">list_check</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tf_upload</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Mensaje_Reporte</span> <span class="o">=</span> <span class="s1">&#39;Tienes todos los archivos necesarios.&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mensaje_Reporte</span> <span class="o">=</span> <span class="s1">&#39;No tienes en carpeta los archivos necesarios.&#39;</span>
    <span class="c1"># Donwlod mensaje:</span>
    <span class="n">list_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">elm1</span> <span class="ow">in</span> <span class="n">files_download</span> <span class="k">for</span> <span class="n">elm1</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;download_file&#39;</span><span class="p">]]</span>
    <span class="n">tf_upload</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">list_check</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tf_upload</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Mensaje_Descargar</span> <span class="o">=</span> <span class="s1">&#39;Tienes todos los archivos necesarios.&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mensaje_Descargar</span> <span class="o">=</span> <span class="s1">&#39;No tienes en carpeta los archivos necesarios.&#39;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span> <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;path_template&#39;</span><span class="p">],</span>
                            <span class="n">servicio</span><span class="o">=</span><span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;servicio&#39;</span><span class="p">],</span>
                            <span class="n">Mensaje_Reporte</span> <span class="o">=</span> <span class="n">Mensaje_Reporte</span><span class="p">,</span>
                            <span class="n">Mensaje_Descargar</span> <span class="o">=</span> <span class="n">Mensaje_Descargar</span><span class="p">,</span>
                            <span class="n">Mensaje_Actualizacion</span> <span class="o">=</span> <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;msj_actualizacion&#39;</span><span class="p">],</span>
                            <span class="n">file</span> <span class="o">=</span> <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span>
                            <span class="n">Mensaje_help_1</span> <span class="o">=</span>  <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;msjhelp1&#39;</span><span class="p">],</span>
                            <span class="n">Mensaje_help_2</span> <span class="o">=</span>  <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;msjhelp2&#39;</span><span class="p">],</span>
                            <span class="n">Mensaje_help_3</span> <span class="o">=</span>  <span class="n">sessions</span><span class="p">[</span><span class="s1">&#39;msjhelp3&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="normalizacion_col"><a class="viewcode-back" href="../../../reportes.backend.html#reportes.backend.dll_copy.normalizacion_col">[docs]</a><span class="k">def</span> <span class="nf">normalizacion_col</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">unidecode</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">df</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Carlos Riascos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>